<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class Model_dine extends CI_Model {    function __construct()    {        parent::__construct();    }        function getModule($module_name){            $data = array();            $sql="select module_id , module_group_id from tbl_module where module_path='".$module_name."' ";         		 $hasil = $this->db->query($sql);                        if($hasil->num_rows() > 0){				$data = $hasil->result();			}                        else{                            $data = '';                        }			$hasil->free_result();                        $this->db->close();			return $data;                 }         function getListDine($cond = null){		  $query	    = "SELECT  a.dine_id,  a.dine_title, a.dine_image, a.dine_desc,a.dine_order,"                                    . " a.dine_image, a.dine_active_status,"                                    . "DATE_FORMAT( a.dine_create_date, '%d-%m-%Y %H:%i:%s' ) as dine_create_date, a.dine_create_by "                                                                      . "FROM tbl_dine as a "                                    . " ".$cond;		$query		= $this->db->query($query)->result_array();		return $query;	}         		function getListDineAlias(){		 $query		= "SELECT dine_id, dine_title, dine_image, dine_desc,						DATE_FORMAT( dine_create_date, '%d %M %Y' ) as dine_create_date,						c.web_alias, c.web_ori						FROM tbl_dine a						INNER JOIN tbl_alias c ON a.dine_id = c.key_id 						WHERE a.dine_active_status = 1 AND c.alias_category = 'dine' AND c.alias_active_status = 1						ORDER BY dine_id DESC";		$query		= $this->db->query($query)->result_array();		return $query;	}		function getDine($id = '')	{		$where = '';		if($id != ''){			$where = "WHERE dine_id = ".$id;		}		 $sql	= "SELECT a.dine_id,a.dine_title,a.dine_name,a.dine_time,a.dine_image, a.dine_active_status,a.dine_desc,a.dine_urla,a.dine_urlb, "                                    . "DATE_FORMAT( a.dine_create_date, '%d-%m-%Y %H:%i:%s' ) as dine_create_date, a.dine_create_by "                                                                      . "FROM tbl_dine as a "                                    . " $where "                                    . " ORDER BY dine_id ASC";			$query	= $this->db->query($sql);		$rs		= $query->result_array(); 		return $rs;		}	function checkDine($dine_title){		$sql	= "SELECT dine_title FROM tbl_dine WHERE dine_title = '".$dine_title."'";		$query	= $this->db->query($sql);		$rs		= $query->result_array(); 		return $rs;	}	function activeDine($id)	{		$sql	= "UPDATE tbl_dine SET dine_active_status = abs(dine_active_status-1),  				   dine_update_date = now(), 				   dine_update_by = ".$_SESSION['admin_data']['user_id']."				   WHERE dine_id = ".$id;			$query	= $this->db->query($sql);				return $query;	}	function deleteDine($id = '')	{		$sql	= "DELETE FROM tbl_dine WHERE dine_id = ".$id;			$query	= $this->db->query($sql);				$str = $this->db->last_query();				return $str;	}        function insertDine($dine_title,$dine_name,$dine_time, $dine_imageurl,$dine_desc,$dine_urla,$dine_urlb)	{		$sql	= "INSERT INTO tbl_dine SET                             dine_title='".$dine_title."',                            dine_name='".$dine_name."',                            dine_time='".$dine_time."',                            dine_image='".$dine_imageurl."',                            dine_desc='".$dine_desc."',                            dine_urla='".$dine_urla."',                            dine_urlb='".$dine_urlb."',                            dine_create_by = ".$_SESSION['admin_data']['user_id'].", dine_create_date = now()";					$query  = $this->db->query($sql);		$last_id  = $this->db->insert_id();		return $last_id;	}	function updateDine($id,$dine_title,$dine_name,$dine_time, $dine_imageurl,$dine_desc,$dine_urla,$dine_urlb)	{		 $sql	= "UPDATE tbl_dine SET                             dine_title='".$dine_title."',                            dine_name='".$dine_name."',                            dine_time='".$dine_time."',                            dine_image='".$dine_imageurl."',                            dine_desc='".$dine_desc."',                            dine_urla='".$dine_urla."',                            dine_urlb='".$dine_urlb."',                            dine_update_by = ".$_SESSION['admin_data']['user_id'].",                             dine_update_date=now() WHERE dine_id = ".$id;			$query	= $this->db->query($sql);		return $query;	}         function updateOrderDine($id,$order)	{		$sql	= "UPDATE tbl_dine SET 				   dine_order= ".$order.",				   dine_update_by = ".$_SESSION['admin_data']['user_id'].", dine_update_date=now() WHERE dine_id = ".$id;			$query	= $this->db->query($sql);				return $query;	}         function getPageView(){         $data = array();         $sql="select * from tbl_page_view order by page_type asc";                  $hasil = $this->db->query($sql);                        if($hasil->num_rows() > 0){				$data = $hasil->result();			}                        else{                            $data = '';                        }			$hasil->free_result();                        $this->db->close();			return $data;              }          function GenerateDine($cond = null){            $query		 = "SELECT  a.dine_id,  a.dine_title, a.dine_name, a.dine_time, a.dine_image, a.dine_desc,a.dine_order, a.dine_urla,a.dine_urlb,"                                    . "a.dine_active_status "                                                                    . "FROM tbl_dine as a "                                    . " ".$cond;                    $query = $this->db->query($query)->result_array();                    $data  = array();                    foreach ($query as $row) {                    $data[] = array(                    'dine_id' => $row['dine_id'],                    'dine_title' => $row['dine_title'],                    'dine_name' => $row['dine_name'],                    'dine_time' => $row['dine_time'],                    'dine_image' => $row['dine_image'],                    'dine_desc' => $row['dine_desc'],                    'dine_order' => $row['dine_order'],                    'dine_urla' => $row['dine_urla'],                    'dine_urlb' => $row['dine_urlb'],                    'menu' => $this->getMenu($row['dine_id']),                    'gallery' => $this->getGallery($row['dine_id'])                                    );            }            //$query->free_result();            $this->db->close();            return $data;	} function getMenu($dine_id){		 $query	 = "SELECT a.dine_menu_id, a.dine_menu_title,a.dine_menu_desc,"                                    . " a.dine_menu_active_status,"                                    . "a.dine_menu_order "                                    . "FROM tbl_dine_menu as a "                                    . " inner join tbl_dine as b on a.dine_id = b.dine_id "                                    . " where a.dine_menu_active_status =1 and a.dine_id =".$dine_id." order by a.dine_menu_order ASC";                                    		$query		= $this->db->query($query)->result_array();		return $query;	}function getGallery($dine_id){		 $query	 = "SELECT a.dine_gallery_id, a.dine_gallery_title,a.dine_gallery_image,"                                    . " a.dine_gallery_active_status,"                                    . "a.dine_gallery_order "                                    . "FROM tbl_dine_gallery as a "                                    . " inner join tbl_dine as b on a.dine_id = b.dine_id "                                    . " where a.dine_gallery_active_status =1 and a.dine_id =".$dine_id." order by a.dine_gallery_order ASC";                                    		$query		= $this->db->query($query)->result_array();		return $query;	}     }